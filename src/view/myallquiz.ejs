<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebQuizzer ‚Äì Tous les quiz</title>
    <link rel="stylesheet" href="/allquiz.css" />
    <link rel="stylesheet" href="/home.css" />
</head>
<body>
    <aside class="side-nav">
        <div class="logo">WebQuizzer</div>
        <nav class="side-menu">
            <a href="/" class="side-link">Accueil</a>
            <a href="/quizzes/all" class="side-link active">Tous les quiz</a>
            <a href="/quizzes/mine" class="side-link">Mes quiz</a>
            <a href="/quizzes/new" class="side-link create">Cr√©er</a>
            <% if (user && user.role==="admin") { %>
                <a href="/admin" class="side-link create">Admin</a>
            <% } %>
            <a href="/profile" class="side-link profile-link">üë§ <span>Profil</span></a>
        </nav>
        <div class="side-footer">
            <p id="welcome"></p>
            <a href="/login" id="authButton" class="btn-side-login">Connexion</a>
        </div>
    </aside>

    <main class="main">
        <div class="page-header">
            <h1>üåê Tous les quiz</h1>
            <p class="subtitle">D√©couvrez tous les quiz disponibles</p>
        </div>

        <div class="search-container">
            <input id="quizSearch" type="text" class="search-input" placeholder="üîç Rechercher un quiz..." />
        </div>

        <div id="cards-grid" class="quiz-grid"></div>

        <div id="empty-state" class="empty-state" style="display: none;">
            <div class="empty-state-icon">üì≠</div>
            <h2>Aucun quiz disponible</h2>
        </div>
    </main>

    <script>
        const me = <%- JSON.stringify(user || null) %>;
        let allQuizzes = [];

        const welcome = document.getElementById("welcome");
        const authBtn = document.getElementById("authButton");
        if (me) {
            welcome.textContent = "Bonjour " + me.nom;
            authBtn.textContent = "D√©connexion";
            authBtn.href = "#";
            authBtn.onclick = async (e) => {
                e.preventDefault();
                await fetch("/logout", { credentials: "include" });
                location.href = "/";
            };
        }

        const grid = document.getElementById("cards-grid");
        const empty = document.getElementById("empty-state");

        function renderQuizzes(quizzes) {
            grid.innerHTML = "";

            if (quizzes.length === 0) {
                empty.style.display = "block";
                return;
            }

            empty.style.display = "none";
            quizzes.forEach(q => {
                const card = document.createElement("div");
                card.className = "quiz-card";
                card.innerHTML = `<div class="thumb"></div><div class="title">${q.titre}</div>`;
                card.onclick = () => location.href = "/quizzes/" + q.id;
                grid.appendChild(card);
            });
        }

        fetch("/quizzes")
            .then(r => r.json())
            .then(quizzes => {
                allQuizzes = quizzes;
                renderQuizzes(allQuizzes);

                document.getElementById("quizSearch").oninput = (e) => {
                    const term = e.target.value.toLowerCase();
                    const filtered = allQuizzes.filter(q => q.titre.toLowerCase().includes(term));
                    renderQuizzes(filtered);
                };
            });
    </script>
</body>
</html>